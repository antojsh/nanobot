version: '3.8'

services:
  nanobot:
    build: .
    container_name: nanobot_ai
    restart: always
    entrypoint: ["/bin/sh", "-c"]
    
    # SOLUCIÃ“N: Metemos la config de Telegram dentro de "channels"
    command: 
      - |
        mkdir -p /root/.nanobot
        echo "{\"channels\":{\"telegram\":{\"enabled\":true,\"token\":\"$TELEGRAM_BOT_TOKEN\",\"admins\":[\"$TELEGRAM_ADMIN_ID\"]}},\"providers\":{\"openai\":{\"apiKey\":\"$DEEPSEEK_API_KEY\",\"baseURL\":\"https://api.deepseek.com\"}},\"agents\":{\"defaults\":{\"model\":\"deepseek-chat\"}}}" > /root/.nanobot/config.json
        nanobot gateway
    
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_ADMIN_ID=${TELEGRAM_ADMIN_ID}
      - PYTHONUNBUFFERED=1
    
    volumes:
      - nanobot_session_data:/root/.nanobot
    
    ports:
      - "18790:18790"

volumes:
  nanobot_session_data:
